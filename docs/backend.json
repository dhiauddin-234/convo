{
  "entities": {
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Represents a user profile in the Convo application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user profile."
        },
        "username": {
          "type": "string",
          "description": "The user's chosen username."
        },
        "email": {
          "type": "string",
          "description": "The user's email address.",
          "format": "email"
        },
        "displayName": {
          "type": "string",
          "description": "The user's display name, shown in the app."
        },
        "profilePictureUrl": {
          "type": "string",
          "description": "URL of the user's profile picture.",
          "format": "uri"
        },
        "lastSeen": {
          "type": "string",
          "description": "Timestamp of the user's last activity.",
          "format": "date-time"
        },
        "isOnline": {
          "type": "boolean",
          "description": "Boolean indicating whether the user is currently online."
        }
      },
      "required": [
        "id",
        "username",
        "email",
        "displayName"
      ]
    },
    "ChatMessage": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ChatMessage",
      "type": "object",
      "description": "Represents a single chat message.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the chat message."
        },
        "senderId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N ChatMessage) The ID of the user who sent the message."
        },
        "roomId": {
          "type": "string",
          "description": "The unique identifier of the chat room the message belongs to."
        },
        "content": {
          "type": "string",
          "description": "The text content of the message."
        },
        "timestamp": {
          "type": "string",
          "description": "Timestamp of when the message was sent.",
          "format": "date-time"
        },
        "isModerated": {
          "type": "boolean",
          "description": "Indicates whether the message has been moderated."
        }
      },
      "required": [
        "id",
        "senderId",
        "roomId",
        "content",
        "timestamp"
      ]
    },
    "ChatRoom": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ChatRoom",
      "type": "object",
      "description": "Represents a one-to-one chat room between two users.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the chat room."
        },
        "users": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Array containing the UIDs of the two users in the chat room."
        },
        "lastMessageTimestamp": {
          "type": "string",
          "description": "Timestamp of the last message sent in the chat room.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "users"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores user profiles. Uses the document ID as the user ID for ownership.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      },
      {
        "path": "/chats/{chatId}",
        "definition": {
          "entityName": "ChatRoom",
          "schema": {
            "$ref": "#/backend/entities/ChatRoom"
          },
          "description": "Stores chat room metadata. `users` array defines the members of the chat, which are used for authorization.",
          "params": [
            {
              "name": "chatId",
              "description": "The unique identifier of the chat room."
            }
          ]
        }
      },
      {
        "path": "/chats/{chatId}/messages/{messageId}",
        "definition": {
          "entityName": "ChatMessage",
          "schema": {
            "$ref": "#/backend/entities/ChatMessage"
          },
          "description": "Stores chat messages within chat rooms. Authorization depends on the `chatId`. Security rules check if the user is a participant in the parent `chats` document.",
          "params": [
            {
              "name": "chatId",
              "description": "The unique identifier of the chat room."
            },
            {
              "name": "messageId",
              "description": "The unique identifier of the chat message."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed for direct document access and simple queries, which aligns with the application's current implementation. User profiles are stored at the root of a 'users' collection, making them easy to query. Chat rooms and their sub-collections of messages also follow a straightforward path structure ('chats/{chatId}/messages/{messageId}'). This simplifies security rules and application logic."
  }
}